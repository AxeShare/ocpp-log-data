# -*- coding: utf-8 -*-
"""
Created on Thu Jun  3 16:46:37 2021

@author: Akshay Bhatia
"""


import pandas as pd
import math

mv = []
soc = []
cid = []
tid = []


#chg_dec1 = [743, 745, 753, 755, 759, 761, 763, 765, 767, 771, 775, 777, 779, 781, 783, 785, 787, 789, 791, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 826, 827, 828, 829, 830, 831, 833, 835, 838, 839, 840, 841, 842, 843, 844, 846, 859, 888, 889, 932, 938, 1015, 1016, 1017, 1019, 1021, 1023, 1025, 1027, 1029, 1031, 1044, 1045, 1046, 1047, 1050, 1067, 1074, 1088, 1111, 1116, 1118, 1132, 1134, 1136, 1139, 1142, 1143, 1144, 1146, 1147]
#chg_jan1 = [743, 753, 755, 759, 765, 767, 779, 781, 783, 785, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 826, 827, 829, 830, 831, 839, 840, 841, 842, 843, 844, 846, 847, 859, 888, 889, 932, 938, 1015, 1016, 1017, 1018, 1019, 1020, 1021, 1025, 1029, 1031, 1044, 1045, 1046, 1047, 1050, 1067, 1073, 1074, 1088, 1089, 1111, 1132, 1134, 1136, 1139, 1142, 1143, 1144, 1145, 1146, 1147, 1156, 1157, 1170, 1182]
#chg_nov = [743, 745, 747, 753, 755, 757, 759, 761, 763, 765, 767, 771, 775, 777, 779, 781, 783, 785, 787, 789, 791, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 826, 827, 828, 829, 830, 831, 833, 835, 838, 839, 840, 841, 842, 843, 844, 846, 847, 888, 932, 933, 938, 1004, 1015, 1016, 1017, 1018, 1019, 1021, 1023, 1025, 1027, 1031, 1045, 1047, 1067, 1074, 1088, 1111, 1118, 1132, 1133, 1134, 1136, 1139, 1142, 1143, 1144]

#chg_jan3  = [1015, 1016, 1074, 1111, 1139, 1156, 1169] 
#chg_dec3 = [1111,1139]
#chg_feb = [743, 745, 753, 755, 765, 783, 785, 789, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 825, 826, 828, 829, 830, 831, 839, 840, 841, 842, 843, 844, 846, 847, 889, 938, 1015, 1016, 1017, 1018, 1019, 1020, 1021, 1023, 1044, 1045, 1046, 1047, 1067, 1073, 1074, 1088, 1089, 1092, 1093, 1111, 1118, 1132, 1133, 1134, 1136, 1139, 1142, 1144, 1145, 1146, 1147, 1148, 1182, 1183, 1233, 1237]
#chg_sep = [743, 745, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 771, 773, 775, 777, 779, 781, 783, 785, 787, 789, 791, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 825, 826, 827, 828, 829, 830, 831, 832, 833, 835, 838, 839, 840, 841, 842, 843, 844, 846, 847, 859, 888, 889, 932, 934, 938, 1004, 1015, 1016, 1017, 1018, 1019, 1020, 1029, 1045, 1046, 1047, 1050, 1067, 1074, 1088, 1111]
#chg_oct = [743, 745, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 771, 773, 775, 777, 779, 781, 783, 785, 787, 789, 791, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 826, 827, 828, 829, 830, 831, 833, 835, 838, 839, 840, 841, 842, 843, 844, 846, 847, 859, 888, 932, 934, 938, 1004, 1015, 1016, 1017, 1019, 1021, 1023, 1025, 1027, 1029, 1031, 1044, 1045, 1047, 1050, 1067, 1074, 1088, 1111, 1116, 1118]

#chg_jul = [743, 745, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 771, 773, 775, 777, 779, 781, 783, 785, 787, 789, 791, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 826, 827, 828, 829, 830, 831, 832, 833, 835, 838, 839, 840, 841, 842, 843, 844, 846, 847, 888, 889, 932, 934, 938, 1015, 1016, 1017, 1019, 1044, 1045, 1046, 1047, 1067, 1073, 1074]
#chg_aug = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 771, 773, 775, 777, 779, 781, 785, 787, 789, 791, 814, 815, 816, 817, 818, 820, 821, 822, 823, 824, 825, 826, 827, 828, 829, 830, 831, 832, 833, 835, 838, 839, 840, 841, 842, 843, 844, 846, 847, 888, 934, 938, 1015, 1016, 1017, 1019, 1045, 1046, 1047, 1073, 1074, 1088]
chg_jun = [743, 745, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 771, 773, 775, 777, 779, 781, 783, 785, 787, 789, 791, 814, 817, 818, 820, 821, 822, 823, 824, 825, 826, 827, 829, 830, 831, 832, 833, 835, 838, 839, 840, 841, 842, 843, 844, 846, 847, 888, 889, 932, 933, 938, 1015, 1016, 1017, 1018, 1019, 1020]

for t in chg_jun:
    test1 = False
    test2 = False
    test3 = False
    
    df1 = pd.read_csv(f'out_{t}.csv')
    df1 = df1[df1.EventName == 'MeterValues']
    
    df1.rename(columns={'3_1':'connector'}, inplace=True)
    #df1 = df1[df1.PC != '"PropertyConstraintViolation"']
    df2 = df1[df1.connector == '{"connectorId":1']
    df3 = df1[df1.connector == '{"connectorId":3']
    if not df2.empty:
        df2.to_csv(f'out_{t}_1.csv')
    if not df3.empty:
        df3.to_csv(f'out_{t}_3.csv')
    
    if df1.empty:
        mv.append(-1)
        soc.append(-1)
        tid.append(-1)
        cid.append(t)
        print(t,"empty")
        continue
    s1 = "meterValue"
    s2 = "SoC"
    s3 = "transactionId"
    for j in range(2,len(df1.columns)):
        p = df1.iloc[0][j]
        if type(p) != str:
            if math.isnan(p):
                continue
        if type(p)==str:
            if s1 in p:
                test1 = True
                mv.append(j)
                print(t,j, "mv")
            if s2 in p:
                test2 = True
                soc.append(j)
                print(t,j, "soc")
            if s3 in p:
                test3 = True
                tid.append(j)
                print(t,j,"tid")
        else:
            continue
    cid.append(t)
    if not test1:
        mv.append(-2)
        cid.append(t)
        print(t,-2, "mv")
    if not test2:
        soc.append(-2)
        print(t,-2, "soc")
    if not test3:
        tid.append(-2)
        print(t,-2, "tid")
      
    
    
cat = dict(zip(cid,soc))   
r = dict(sorted(cat.items(), key=lambda item: item[1]))

keyc = list(r.keys())

null = [771, 773, 775, 777, 787, 789, 818, 833, 842, 846, 847, 889, 932, 933]


for1 = [814, 817, 821, 822, 825, 826, 827, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1018, 1019, 1020]
for2 = [745, 783, 838]
for3 = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 779, 781, 785, 791, 820, 823, 824, 832, 888]


sde  = [745, 783, 838, 1015, 1016, 1019, 1020]

s1   = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 779, 781, 785, 791, 820, 823, 824, 832, 888]
s2   = [1017, 1018]
s3   = [814, 817, 821, 822, 825, 826, 827, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938]



























'''
Aug
null = [759, 771, 777, 787, 789, 791, 825, 827, 833, 842, 888, 934, 1017, 1045, 1047]

#tid mv
for1 = [814, 815, 816, 817, 818, 821, 822, 826, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1019, 1046, 1073, 1074, 1088]
for2 = [838]
for3 = [846]
for4 = [847]
for5 = [743, 747, 749, 751, 753, 755, 757, 761, 763, 765, 767, 769, 773, 775, 779, 781, 785, 820, 823, 824, 832]

#tid soc
sde = [816, 838, 1015, 1019, 1088]
s1 = [743, 747, 749, 751, 753, 755, 757, 761, 763, 765, 767, 769, 773, 775, 779, 781, 785, 820, 823, 824, 832]
s2 = [846]
s3 = [847]
s4 = [1016, 1074]
s5 = [814, 815, 817, 818, 821, 822, 826, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1046, 1073]
'''


'''
July analysis
null = [771, 775, 777, 787, 789, 791, 833, 842, 889, 932, 934, 1044, 1045, 1047, 1067]

tid1 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1046, 1073, 1074] #9
tid2 = [745, 783, 838] #15
tid3 = [847] #20
tid4 = [846] #25
tid5 = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 773, 779, 781, 785, 820, 823, 824, 832, 888] #30




#tid-soc
sde = [745, 783, 816, 838, 1015, 1016, 1019, 1074]
s1 = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 773, 779, 781, 785, 820, 823, 824, 832, 888]
s2 = [847]
s3 = [846]
s4 = [1017]
s5 = [814, 815, 817, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1046, 1073]



#tid mv
for1 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1046, 1073, 1074]
for2 = [745, 783, 838] #15
for3 = [847] #20
for4 = [846] #25
for5 = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 773, 779, 781, 785, 820, 823, 824, 832, 888] #30
'''
'''
October Analysis
null = [759, 771, 777, 787, 789, 791, 829, 830, 833, 932, 934, 1004, 1023, 1025, 1027, 1029, 1031, 1044, 1045, 1050, 1116, 1118]
sde = [745, 1015, 1016, 1111]


#tid - mv
for1 = [745]
for2 = [743, 747, 749, 751, 753, 755, 757, 761, 763, 765, 767, 769, 773, 775, 779, 781, 785, 820, 823, 824, 842, 859, 888]
for3 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1021, 1047, 1067, 1074, 1088, 1111]
for4 = [847]
for5 = [783]
for6 = [838, 846]


#tid - soc
s1 = [847]
s2 = [838, 846]
s3 = [783]
s4 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 831, 835, 839, 840, 841, 843, 844, 938, 1021, 1047, 1067] #40
s5 = [1017,1019,1088]
s6 = [1074]
s7 = [743, 747, 749, 751, 753, 755, 757, 761, 763, 765, 767, 769, 773, 775, 779, 781, 785, 820, 823, 824, 842, 859, 888]
'''
'''
September Analysis
null = [771, 777, 783, 787, 789, 791, 815, 817, 825, 833, 889, 932, 934, 1004, 1029, 1045, 1046, 1050, 1111]

#tid-mv
for1 = [814, 816, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1018, 1019, 1020, 1047, 1067, 1074, 1088] #7 8
for2 = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 773, 775, 779, 781, 785, 820, 823, 824, 832, 842, 859, 888]#28 7
for3 = [745,838] #13 7
for4 = [846] #23 7
for5 = [847] #18 7

#tid soc
sde = [745, 816, 838, 1016, 1019]
s1 = [847]
s2 = [846]
s3 = [814, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1047, 1067] #7
s4 = [1015, 1074] #7
s5 = [743, 747, 749, 751, 753, 755, 757, 759, 761, 763, 765, 767, 769, 773, 775, 779, 781, 785, 820, 823, 824, 832, 842, 859, 888] #28
s6 = [1017,1018,1020,1088] #7
'''


'''
February Analysis
#Tid-time
tid1 = [814, 815, 816, 817, 818, 821, 822, 825, 826, 828, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1018, 1019, 1020, 1021, 1023, 1044, 1045, 1046, 1047, 1067, 1073, 1074, 1088, 1089, 1092, 1093, 1111, 1132, 1133, 1134, 1136, 1139, 1142, 1144, 1145, 1146, 1147, 1148, 1182, 1183, 1233, 1237] #7-2
tid2 = [745] #13-2
tid3 = [847] #18-2
tid4 = [846] #23-2
tid5 = [743, 753, 755, 765, 783, 785, 789, 820, 823, 824, 842, 889, 1118] #63-2



#tid-mv-time
for1 = [814, 815, 816, 817, 818, 821, 822, 825, 826, 828, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1018, 1019, 1020, 1021, 1023, 1044, 1045, 1046, 1047, 1067, 1073, 1074, 1088, 1089, 1092, 1093, 1111, 1132, 1133, 1134, 1136, 1139, 1142, 1144, 1145, 1146, 1147, 1148, 1182, 1183, 1233, 1237] #7-8-2
for2 = [745] #13-7-2
for3 = [847] #18-7-2
for4 = [846] #23-7-2
for5 = [743, 753, 755, 765, 783, 785, 789, 820, 823, 824, 842, 889, 1118] #63-7-2



#tid-soc
sde = [840, 1015, 1016, 1074, 1111, 1132, 1134, 1139, 1182, 1183, 1233, 1237]
s1 = [847] #18 14
s2 = [745] #13 19
s3 = [846] #23 19
s4 = [743, 753, 755, 765, 783, 785, 823, 824, 842, 889, 1118] #63 19
s5 = [789, 820] #63 40
s6 = [818, 822, 1017, 1018, 1019, 1020, 1088, 1089, 1092, 1093, 1145, 1146, 1147, 1148] #7 19
s7 = [814, 815, 816, 817, 821, 825, 826, 828, 829, 830, 831, 839, 841, 843, 844, 938, 1021, 1023, 1044, 1045, 1046, 1047, 1067, 1073, 1133, 1136, 1142, 1144] #7 40
'''

'''
December Analysis
#Transaction ID - Metervalue
null = [745, 771, 777, 779, 787, 789, 791, 833, 835, 932, 1021, 1023, 1025, 1027, 1029, 1031, 1050, 1116, 1118]
for1 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1044, 1045, 1046, 1047, 1067, 1074, 1088, 1132, 1134, 1136, 1142, 1143, 1144, 1146, 1147] # Tid 6 7
for2 = [838, 846] #Tid 22 6
for3 = [743, 753, 755, 759, 761, 763, 765, 767, 775, 781, 785, 820, 823, 824, 842, 859, 888, 889] #Tid 27 6
for4 = [783] #Tid 62 6


#TID - time
for1 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1044, 1045, 1046, 1047, 1067, 1074, 1088, 1132, 1134, 1136, 1142, 1143, 1144, 1146, 1147] # Tid 6 2
for2 = [838, 846] #Tid 22 2
for3 = [743, 753, 755, 759, 761, 763, 765, 767, 775, 781, 785, 820, 823, 824, 842, 859, 888, 889] #Tid 27 2
for4 = [783] #Tid 62 2

#Metervalue
mv1 = [743, 753, 755, 759, 761, 763, 765, 767, 775, 781, 783, 785, 820, 823, 824, 838, 842, 846, 859, 888, 889] # mv 6
mv2 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1044, 1045, 1046, 1047, 1067, 1074, 1088, 1132, 1134, 1136, 1142, 1143, 1144, 1146, 1147] #mv 7

#Soc
sde = [1015,1016,1132,1134]

soc1 = [1017, 1019, 1088, 1146, 1147] #6 18
soc2 = [743, 753, 755, 759, 761, 763, 765, 767, 775, 781, 785, 820, 823, 824, 842, 859, 888, 889] #27 23
soc3 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 828, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1044, 1045, 1046, 1047, 1067, 1136, 1142, 1143, 1144] #6 39
soc4 = [783] #62 18
soc5 = [838,846] #22 18
soc6 = [1074] #6 25
'''

'''
January Analysis
#TID - time
null = [745, 761, 771, 775, 789, 791, 833, 835, 933, 934, 1004, 1023, 1027, 1091, 1093, 1116, 1118, 1148, 1152, 1153, 1155, 1180, 1181, 1183, 1185] #tid -1
for1 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1018, 1019, 1020, 1021, 1044, 1045, 1046, 1047, 1067, 1073, 1074, 1088, 1089, 1111, 1132, 1134, 1136, 1139, 1142, 1143, 1144, 1145, 1146, 1147, 1156, 1169, 1170, 1182] #tid 6 2
for2 = [847] #tid 17 2
for3 = [846] #tid 22 2
for4 = [743, 753, 755, 759, 765, 767, 779, 781, 785, 820, 823, 824, 842, 888, 889] #tid 27 2
for5 = [783, 859, 932, 1025, 1029, 1031, 1050, 1157] #tid 62 2



#TID -MV
tmv1 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1018, 1019, 1020, 1021, 1044, 1045, 1046, 1047, 1067, 1073, 1074, 1088, 1089, 1111, 1132, 1134, 1136, 1139, 1142, 1143, 1144, 1145, 1146, 1147, 1156, 1169, 1170, 1182] #6-7
tmv2 = [847] #tid 17 6
tmv3 = [846] #tid 22 6
tmv4 = [743, 753, 755, 759, 765, 767, 779, 781, 785, 820, 823, 824, 842, 888, 889] #tid 27 6
tmv5 = [783, 859, 932, 1025, 1029, 1031, 1050, 1157] #tid 62 6



#Tid -SoC
sde =  [1016, 1132, 1134, 1139, 1156, 1169, 1182]

soc1 = [847] #17 19
soc2 = [846] #22 24
soc3 = [783, 859, 932, 1025, 1029, 1031, 1050, 1157] #62 19
soc4 = [743, 753, 755, 759, 765, 767, 779, 781, 785, 820, 823, 824, 842, 888, 889] #27 24
soc5 = [814, 815, 816, 817, 818, 821, 822, 826, 827, 829, 830, 831, 839, 840, 841, 843, 844, 938, 1021, 1044, 1045, 1046, 1047, 1067, 1073, 1136, 1142, 1143, 1144] #6 40
soc6 = [1017, 1018, 1019, 1020, 1088, 1089, 1145, 1146, 1147, 1170] #6 24
soc7 = [1015, 1074, 1111] #6 26
'''


'''
November Analysis
null = [761, 771, 777, 787, 789, 791, 817, 833, 933, 1004, 1023, 1025, 1027, 1031, 1118]  #empty
err =  [1132,1133]
sde = [745, 1016, 1074, 1111, 1132, 1134, 1139] #soc don't exist

#tID - time sets
for1 = [814, 815, 816, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1021, 1045, 1047, 1067, 1074, 1088, 1111, 1134, 1136, 1139, 1142, 1143, 1144] # 5 2
for2 = [745] # 11 2
for3 = [847] # 16 2
for4 = [838,846] # 21 2
for5 = [743, 747, 753, 755, 757, 759, 763, 765, 767, 775, 779, 781, 785, 820, 823, 824, 842, 888] # 26 2
for6 = [783,932] # 61 2
for7 = [1018] 

#tID - SoC sets
s1 = [1018] #adhoc 33
s2 = [783,932]  #61 17
s3 = [838,846] #21 17
s4 = [1017, 1019, 1088] #5 17
s5 = [847] #16 12
s6 = [743, 747, 753, 755, 757, 759, 763, 765, 767, 775, 779, 781, 785, 820, 823, 824, 842, 888] #26 22
s7 = [1015] #5 24
s8 = [814, 815, 816, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1021, 1045, 1047, 1067, 1136, 1142, 1143, 1144] #5 38


#tID - MeterValue sets
met1 = [743, 747, 753, 755, 757, 759, 763, 765, 767, 775, 779, 781, 785, 820, 823, 824, 842, 888] # 26 5
met2 = [814, 815, 816, 818, 821, 822, 826, 827, 828, 829, 830, 831, 835, 839, 840, 841, 843, 844, 938, 1015, 1016, 1017, 1019, 1021, 1045, 1047, 1067, 1074, 1088, 1111, 1134, 1136, 1139, 1142, 1143, 1144] #5 6
met3 = [745] # 11 5
met4 = [783, 932] #61 5
met5 = [838, 846] #21 5
met6 = [847] # 16 5
met7 = [1018] #adhoc 5
'''